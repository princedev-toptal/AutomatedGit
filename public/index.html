<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Git - Automated Branch, Commit & Push</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .container {
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 0, 0, 0.05);
            padding: 0;
            max-width: 1200px;
            width: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        @media (max-width: 1024px) {
            .container {
                max-width: 800px;
            }
        }

        .header-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
            margin: 0;
        }


        h1 {
            color: #ffffff;
            margin-bottom: 8px;
            font-size: 32px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 15px;
            font-weight: 400;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px 40px 20px;
            background: #f6f8fa;
            border-bottom: 1px solid #e1e4e8;
        }

        .step-item {
            display: flex;
            align-items: center;
            flex: 1;
            max-width: 300px;
        }

        .step-item:not(:last-child) {
            margin-right: 20px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            margin-right: 12px;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .step-item.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .step-item.completed .step-number {
            background: #28a745;
            color: white;
        }

        .step-item.pending .step-number {
            background: #e1e4e8;
            color: #586069;
        }

        .step-label {
            font-weight: 500;
            font-size: 14px;
            color: #24292e;
        }

        .step-item.active .step-label {
            color: #667eea;
            font-weight: 600;
        }

        .step-item.completed .step-label {
            color: #28a745;
        }

        .step-item.pending .step-label {
            color: #959da5;
        }

        .step-connector {
            flex: 1;
            height: 2px;
            background: #e1e4e8;
            margin: 0 20px;
            transition: background 0.3s ease;
        }

        .step-connector.completed {
            background: #28a745;
        }

        /* Step Content */
        .step-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 30px 40px;
        }

        .step-content.active {
            display: flex;
            flex-direction: column;
        }

        .step-content.settings {
            background: #fafbfc;
        }

        .step-content.confirmation {
            background: #ffffff;
        }

        .step-content.console {
            background: #ffffff;
            padding: 0;
        }

        .step-content.help {
            background: #fafbfc;
        }

        .help-section {
            padding: 0;
        }

        .help-section h2 {
            color: #24292e;
            margin-bottom: 12px;
            font-size: 28px;
        }

        .help-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .help-card {
            background: #ffffff;
            border: 1px solid #e1e4e8;
            border-radius: 12px;
            padding: 24px;
            transition: all 0.2s ease;
        }

        .help-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .help-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .help-card h3 {
            color: #24292e;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .help-card p {
            color: #586069;
            font-size: 14px;
            line-height: 1.6;
            margin: 0;
        }

        .help-card code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            color: #e83e8c;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }

        .help-info-box {
            background: #fffbf0;
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .help-info-box h3 {
            color: #24292e;
            font-size: 18px;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 12px;
        }

        .help-info-box ul,
        .help-info-box ol {
            color: #586069;
            font-size: 14px;
            line-height: 1.8;
            margin: 0;
            padding-left: 24px;
        }

        .help-info-box li {
            margin-bottom: 8px;
        }

        .help-info-box code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            color: #e83e8c;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }

        .form-section {
            display: flex;
            flex-direction: column;
        }

        .console-section {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        label {
            display: block;
            margin-bottom: 6px;
            color: #24292e;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: -0.01em;
        }

        input, select {
            width: 100%;
            padding: 10px 14px;
            border: 1.5px solid #d1d5da;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: #ffffff;
            color: #24292e;
            font-family: inherit;
        }

        input:hover, select:hover {
            border-color: #c6cbd1;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .help-text {
            font-size: 12px;
            color: #6a737d;
            margin-top: 4px;
            line-height: 1.5;
        }

        .help-text code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            color: #e83e8c;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }

        button {
            width: 100%;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
            letter-spacing: 0.01em;
        }

        button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            margin-top: 16px;
            padding: 14px 16px;
            border-radius: 8px;
            display: none;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            border-left: 4px solid;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left-color: #17a2b8;
        }

        .progress-console {
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            height: calc(100vh - 200px);
            min-height: 600px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            border: 1px solid #2d2d2d;
        }

        .console-header {
            background: linear-gradient(180deg, #2d2d2d 0%, #252525 100%);
            padding: 12px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #fff;
            font-weight: 600;
            border-bottom: 1px solid #1a1a1a;
            font-size: 14px;
            box-shadow: 0 1px 0 rgba(255, 255, 255, 0.05) inset;
        }

        .console-clear {
            background: #3d3d3d;
            color: #fff;
            border: 1px solid #4d4d4d;
            padding: 6px 14px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .console-clear:hover {
            background: #4d4d4d;
            border-color: #5d5d5d;
        }

        .console-content {
            padding: 18px;
            overflow-y: auto;
            color: #d4d4d4;
            font-size: 13px;
            line-height: 1.7;
            flex: 1;
            background: #1e1e1e;
        }

        .console-content::-webkit-scrollbar {
            width: 8px;
        }

        .console-content::-webkit-scrollbar-track {
            background: #252525;
        }

        .console-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        .console-content::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .console-line {
            margin-bottom: 6px;
            word-wrap: break-word;
            padding: 2px 0;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }

        .console-line.info {
            color: #4ec9b0;
        }

        .console-line.success {
            color: #89d185;
        }

        .console-line.error {
            color: #f48771;
        }

        .console-line.warning {
            color: #dcdcaa;
        }

        .console-line.progress {
            color: #569cd6;
        }

        .results {
            margin-top: 16px;
            max-height: 300px;
            overflow-y: auto;
            padding: 16px;
            background: #f6f8fa;
            border-radius: 8px;
            display: none;
            font-size: 13px;
            border: 1px solid #e1e4e8;
        }

        .results::-webkit-scrollbar {
            width: 8px;
        }

        .results::-webkit-scrollbar-track {
            background: #f1f3f5;
        }

        .results::-webkit-scrollbar-thumb {
            background: #c6cbd1;
            border-radius: 4px;
        }

        .results::-webkit-scrollbar-thumb:hover {
            background: #959da5;
        }

        .result-item {
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .result-item.error {
            border-left-color: #dc3545;
        }

        .result-item.success {
            border-left-color: #28a745;
        }

        .loading {
            display: none !important;
        }

        .check-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .check-modal.active {
            display: flex;
        }

        .check-content {
            background: white;
            border-radius: 24px;
            padding: 0;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
        }

        .check-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 32px 40px;
            text-align: center;
        }

        .check-header h2 {
            margin: 0 0 8px 0;
            font-size: 28px;
            font-weight: 700;
        }

        .check-header p {
            margin: 0;
            opacity: 0.95;
            font-size: 15px;
        }

        .check-body {
            padding: 32px 40px;
            overflow-y: auto;
            flex: 1;
        }

        .check-section {
            margin: 0 0 28px 0;
            padding: 20px 24px;
            background: #f6f8fa;
            border-radius: 12px;
            border: 1px solid #e1e4e8;
        }

        .check-section:last-child {
            margin-bottom: 0;
        }

        .check-section h3 {
            margin: 0 0 16px 0;
            color: #24292e;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .check-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e1e4e8;
        }

        .check-item:last-child {
            border-bottom: none;
        }

        .check-label {
            font-weight: 500;
            color: #586069;
            font-size: 14px;
        }

        .check-value {
            color: #24292e;
            text-align: right;
            font-weight: 500;
            font-size: 14px;
        }

        .check-warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .check-error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .check-success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .check-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .check-buttons button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-confirm {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-cancel:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .dates-preview {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        /* Navigation Buttons */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 40px;
            background: #f6f8fa;
            border-top: 1px solid #e1e4e8;
            gap: 12px;
        }

        .btn-next, .btn-back {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-next {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
            margin-left: auto;
        }

        .btn-next:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-back {
            background: #f1f3f5;
            color: #24292e;
            border: 1px solid #d1d5da;
        }

        .btn-back:hover {
            background: #e1e4e8;
            border-color: #c6cbd1;
        }

        .btn-next:disabled, .btn-back:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .step-content.confirmation .step-navigation {
            display: flex;
        }

        .step-content.console .step-navigation {
            display: none;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>üöÄ Auto Git</h1>
            <p class="subtitle">Automated Branch Creation, Commits & Push</p>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step-item active" id="step0">
                <div class="step-number">1</div>
                <div class="step-label">Help</div>
            </div>
            <div class="step-connector" id="connector0"></div>
            <div class="step-item pending" id="step1">
                <div class="step-number">2</div>
                <div class="step-label">Settings</div>
            </div>
            <div class="step-connector" id="connector1"></div>
            <div class="step-item pending" id="step2">
                <div class="step-number">3</div>
                <div class="step-label">Confirmation</div>
            </div>
            <div class="step-connector" id="connector2"></div>
            <div class="step-item pending" id="step3">
                <div class="step-number">4</div>
                <div class="step-label">Console</div>
            </div>
        </div>

        <!-- Step 0: Help -->
        <div class="step-content help active" id="helpStep">
            <div class="help-section">
                <h2>üìö Welcome to Auto Git</h2>
                <p style="font-size: 16px; color: #586069; margin-bottom: 30px;">
                    Automatically create branches, commits, and push for a date range while excluding Sundays and holidays.
                </p>

                <div class="help-grid">
                    <div class="help-card">
                        <div class="help-icon">üìÖ</div>
                        <h3>Date Range</h3>
                        <p>Select your start and end dates. The app will automatically exclude Sundays and country-specific holidays.</p>
                    </div>

                    <div class="help-card">
                        <div class="help-icon">üåç</div>
                        <h3>Country Selection</h3>
                        <p>Choose your country to exclude its specific holidays. Supports 35+ countries with their national holidays.</p>
                    </div>

                    <div class="help-card">
                        <div class="help-icon">üåø</div>
                        <h3>Branches & Commits</h3>
                        <p>Specify how many branches to create and total commits. Commits are randomly distributed across branches.</p>
                    </div>

                    <div class="help-card">
                        <div class="help-icon">üìÅ</div>
                        <h3>Repository</h3>
                        <p>Provide a local path or GitHub URL. The app will clone or initialize the repository automatically.</p>
                    </div>

                    <div class="help-card">
                        <div class="help-icon">üîÄ</div>
                        <h3>Pull Requests</h3>
                        <p>Optionally create and auto-merge pull requests. Requires a GitHub Personal Access Token with <code>repo</code> scope.</p>
                    </div>
                </div>

                <div class="help-info-box">
                    <h3>üí° Quick Tips</h3>
                    <ul>
                        <li>Make sure you have Git configured on your system</li>
                        <li>For PR creation, you'll need a GitHub Personal Access Token</li>
                        <li>Required token scopes: <code>repo</code> (for PRs), <code>user:follow</code> and <code>public_repo</code> (for auto-follow/star)</li>
                        <li>The repository will be created/initialized if it doesn't exist</li>
                        <li>You need to add a remote repository before pushing (e.g., <code>git remote add origin &lt;url&gt;</code>)</li>
                    </ul>
                </div>

                <div class="help-info-box" style="background: #e7f3ff; border-left-color: #0969da;">
                    <h3>üöÄ Getting Started</h3>
                    <ol>
                        <li>Fill in the date range and select your country</li>
                        <li>Set the number of branches and total commits</li>
                        <li>Enter your repository path or GitHub URL</li>
                        <li>Optionally enable PR creation and provide a token</li>
                        <li>Click "Next" to review your settings</li>
                        <li>Confirm and watch the magic happen! ‚ú®</li>
                    </ol>
                </div>
            </div>
            <div class="step-navigation">
                <div></div>
                <button type="button" id="helpNextBtn" class="btn-next">Get Started ‚Üí</button>
            </div>
        </div>

        <!-- Step 1: Settings -->
        <div class="step-content settings" id="settingsStep">
            <div class="form-section">
                <form id="gitForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" name="startDate" required>
                    <div class="help-text">First date to process</div>
                </div>

                <div class="form-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate" name="endDate" required>
                    <div class="help-text">Last date to process</div>
                </div>

                <div class="form-group full-width">
                    <label for="country">Country</label>
                    <select id="country" name="country" required>
                        <option value="">Loading countries...</option>
                    </select>
                    <div class="help-text">Select country to exclude its holidays (Sundays are always excluded)</div>
                </div>

                <div class="form-group">
                    <label for="numBranches">Number of Branches</label>
                    <input type="number" id="numBranches" name="numBranches" min="1" step="1" value="10" required>
                    <div class="help-text">Number of branches to create</div>
                </div>

                <div class="form-group">
                    <label for="totalCommits">Total Commits</label>
                    <input type="number" id="totalCommits" name="totalCommits" min="1" step="1" value="10" required>
                    <div class="help-text">Total commits (randomly distributed)</div>
                </div>

                <div class="form-group full-width">
                    <label for="repoPath">Repository Path or URL</label>
                    <input type="text" id="repoPath" name="repoPath" placeholder="./repo or https://github.com/owner/repo" value="./repo" required>
                    <div class="help-text">
                        Local path (e.g., <code>./repo</code>) or GitHub URL (e.g., <code>https://github.com/owner/repo</code>).
                        <br>If URL is provided, repository will be cloned automatically. If local path, repository will be created/initialized.
                    </div>
                </div>

                <div class="form-group">
                    <label for="remote">Remote Name</label>
                    <input type="text" id="remote" name="remote" placeholder="origin" value="origin">
                    <div class="help-text">Git remote name</div>
                </div>

                <div class="form-group full-width">
                    <label>
                        <input type="checkbox" id="createPR" name="createPR" style="width: auto; margin-right: 8px;">
                        Create Pull Requests
                    </label>
                    <div class="help-text">Automatically create PRs after pushing branches</div>
                </div>

                <div id="prOptions" class="form-group full-width" style="display: none;">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="platform">Platform</label>
                            <select id="platform" name="platform">
                                <option value="github">GitHub</option>
                                <option value="gitlab">GitLab (Coming Soon)</option>
                                <option value="bitbucket">Bitbucket (Coming Soon)</option>
                            </select>
                            <div class="help-text">Git hosting platform</div>
                        </div>

                        <div class="form-group">
                            <label for="baseBranch">Base Branch</label>
                            <input type="text" id="baseBranch" name="baseBranch" placeholder="main" value="main">
                            <div class="help-text">Branch to merge PRs into</div>
                        </div>

                        <div class="form-group full-width">
                            <label for="prToken">API Token <span id="prTokenRequired" style="color: red; display: none;">*</span></label>
                            <input type="password" id="prToken" name="prToken" placeholder="ghp_xxxxxxxxxxxx">
                            <div class="help-text">
                                <strong>Required for PR creation.</strong> Personal Access Token for API access.
                                <br>GitHub: Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Generate new token (classic)
                                <br>Required scopes: <code>repo</code> (full control of private repositories)
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label>
                                <input type="checkbox" id="autoMerge" name="autoMerge" style="width: auto; margin-right: 8px;">
                                Auto-merge PRs
                            </label>
                            <div class="help-text">Automatically merge PRs after creation</div>
                        </div>

                        <div class="form-group" id="mergeMethodGroup" style="display: none;">
                            <label for="mergeMethod">Merge Method</label>
                            <select id="mergeMethod" name="mergeMethod">
                                <option value="merge">Merge Commit</option>
                                <option value="squash">Squash and Merge</option>
                                <option value="rebase">Rebase and Merge</option>
                            </select>
                            <div class="help-text">How to merge the PR</div>
                        </div>
                    </div>
                </div>
            </div>
            </form>

                <div class="status" id="status"></div>
                <div class="results" id="results"></div>
            </div>
            <div class="step-navigation">
                <button type="button" id="settingsBackBtn" class="btn-back">‚Üê Back to Help</button>
                <button type="button" id="nextBtn" class="btn-next">Next: Review Settings ‚Üí</button>
            </div>
        </div>

        <!-- Step 2: Confirmation -->
        <div class="step-content confirmation" id="confirmationStep">
            <div class="confirmation-header">
                <h2>üîç Review Settings</h2>
                <p>Please review all settings before proceeding</p>
            </div>
            <div class="confirmation-body">
                <div id="checkContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
            <div class="step-navigation">
                <button type="button" id="backBtn" class="btn-back">‚Üê Back to Settings</button>
                <button type="button" id="confirmBtn" class="btn-next">Confirm & Process ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: Console -->
        <div class="step-content console" id="consoleStep">
            <div class="console-section">
                <div class="progress-console" id="progressConsole">
                    <div class="console-header">
                        <span>üìä Progress Console</span>
                        <button class="console-clear" onclick="clearConsole()">Clear</button>
                    </div>
                    <div class="console-content" id="consoleContent">
                        <div class="console-line info">Ready to process. Fill out the form and click "Next" to review settings.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('gitForm');
        const status = document.getElementById('status');
        const results = document.getElementById('results');
        const progressConsole = document.getElementById('progressConsole');
        const countrySelect = document.getElementById('country');
        const checkContent = document.getElementById('checkContent');
        
        // Step management
        let currentStep = 0;
        let currentFormData = null;
        let checkData = null;

        // Step elements
        const helpStep = document.getElementById('helpStep');
        const settingsStep = document.getElementById('settingsStep');
        const confirmationStep = document.getElementById('confirmationStep');
        const consoleStep = document.getElementById('consoleStep');
        const nextBtn = document.getElementById('nextBtn');
        const backBtn = document.getElementById('backBtn');
        const confirmBtn = document.getElementById('confirmBtn');
        const helpNextBtn = document.getElementById('helpNextBtn');

        // Step indicator elements
        const step0 = document.getElementById('step0');
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const connector0 = document.getElementById('connector0');
        const connector1 = document.getElementById('connector1');
        const connector2 = document.getElementById('connector2');

        function showStep(step) {
            // Hide all steps
            helpStep.classList.remove('active');
            settingsStep.classList.remove('active');
            confirmationStep.classList.remove('active');
            consoleStep.classList.remove('active');

            // Show selected step
            if (step === 0) {
                helpStep.classList.add('active');
            } else if (step === 1) {
                settingsStep.classList.add('active');
            } else if (step === 2) {
                confirmationStep.classList.add('active');
            } else if (step === 3) {
                consoleStep.classList.add('active');
            }

            // Update step indicator
            step0.classList.remove('active', 'completed', 'pending');
            step1.classList.remove('active', 'completed', 'pending');
            step2.classList.remove('active', 'completed', 'pending');
            step3.classList.remove('active', 'completed', 'pending');
            connector0.classList.remove('completed');
            connector1.classList.remove('completed');
            connector2.classList.remove('completed');

            if (step === 0) {
                step0.classList.add('active');
                step1.classList.add('pending');
                step2.classList.add('pending');
                step3.classList.add('pending');
            } else if (step === 1) {
                step0.classList.add('completed');
                step1.classList.add('active');
                step2.classList.add('pending');
                step3.classList.add('pending');
                connector0.classList.add('completed');
            } else if (step === 2) {
                step0.classList.add('completed');
                step1.classList.add('completed');
                step2.classList.add('active');
                step3.classList.add('pending');
                connector0.classList.add('completed');
                connector1.classList.add('completed');
            } else if (step === 3) {
                step0.classList.add('completed');
                step1.classList.add('completed');
                step2.classList.add('completed');
                step3.classList.add('active');
                connector0.classList.add('completed');
                connector1.classList.add('completed');
                connector2.classList.add('completed');
            }

            currentStep = step;
        }

        // Load countries on page load
        async function loadCountries() {
            try {
                const response = await fetch('/api/countries');
                const data = await response.json();
                
                if (data.success) {
                    countrySelect.innerHTML = '';
                    
                    // Group countries by region
                    const regions = {};
                    data.countries.forEach(country => {
                        const region = country.region || 'Other';
                        if (!regions[region]) {
                            regions[region] = [];
                        }
                        regions[region].push(country);
                    });
                    
                    // Create optgroups for each region
                    const regionOrder = [
                        'North America',
                        'Europe',
                        'Asia-Pacific',
                        'South America',
                        'Africa & Middle East',
                        'Other'
                    ];
                    
                    regionOrder.forEach(region => {
                        if (regions[region] && regions[region].length > 0) {
                            const optgroup = document.createElement('optgroup');
                            optgroup.label = region;
                            
                            regions[region].forEach(country => {
                                const option = document.createElement('option');
                                option.value = country.code;
                                option.textContent = country.name;
                                if (country.code === 'US') {
                                    option.selected = true;
                                }
                                optgroup.appendChild(option);
                            });
                            
                            countrySelect.appendChild(optgroup);
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading countries:', error);
                countrySelect.innerHTML = '<option value="US">United States</option>';
            }
        }

        // Load countries when page loads
        loadCountries();

        // Help step next button handler
        helpNextBtn.addEventListener('click', () => {
            showStep(1);
        });

        // Show/hide PR options based on checkbox
        const createPRCheckbox = document.getElementById('createPR');
        const prOptionsDiv = document.getElementById('prOptions');
        const autoMergeCheckbox = document.getElementById('autoMerge');
        const mergeMethodGroup = document.getElementById('mergeMethodGroup');

        if (createPRCheckbox) {
            createPRCheckbox.addEventListener('change', () => {
                const isChecked = createPRCheckbox.checked;
                prOptionsDiv.style.display = isChecked ? 'block' : 'none';
                
                // Update required attribute and indicator
                const prTokenInput = document.getElementById('prToken');
                const prTokenRequired = document.getElementById('prTokenRequired');
                
                if (isChecked) {
                    prTokenInput.setAttribute('required', 'required');
                    prTokenRequired.style.display = 'inline';
                } else {
                    prTokenInput.removeAttribute('required');
                    prTokenRequired.style.display = 'none';
                    // Clear the token value when PR creation is disabled
                    prTokenInput.value = '';
                }
            });
        }

        if (autoMergeCheckbox) {
            autoMergeCheckbox.addEventListener('change', () => {
                mergeMethodGroup.style.display = autoMergeCheckbox.checked ? 'block' : 'none';
            });
        }

        // Next button handler (Step 1 -> Step 2)
        nextBtn.addEventListener('click', async () => {
            // Validate form
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Get form data
            const formData = {
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                country: document.getElementById('country').value,
                numBranches: parseInt(document.getElementById('numBranches').value),
                totalCommits: parseInt(document.getElementById('totalCommits').value),
                repoPath: document.getElementById('repoPath').value,
                remote: document.getElementById('remote').value || 'origin',
                createPR: document.getElementById('createPR').checked,
                autoMerge: document.getElementById('autoMerge').checked,
                prToken: document.getElementById('prToken').value,
                baseBranch: document.getElementById('baseBranch').value || 'main',
                platform: document.getElementById('platform').value,
                mergeMethod: document.getElementById('mergeMethod').value || 'merge'
            };

            // Validate number of branches and total commits
            if (formData.numBranches < 1) {
                showStatus('Number of branches must be at least 1', 'error');
                return;
            }

            if (formData.totalCommits < 1) {
                showStatus('Total commits must be at least 1', 'error');
                return;
            }

            if (formData.totalCommits < formData.numBranches) {
                showStatus('Total commits must be at least equal to the number of branches (each branch needs at least 1 commit)', 'error');
                return;
            }

            // Validate API token if PR creation is enabled
            if (formData.createPR) {
                const prToken = document.getElementById('prToken').value.trim();
                if (!prToken) {
                    showStatus('API Token is required when "Create Pull Requests" is enabled', 'error');
                    document.getElementById('prToken').focus();
                    return;
                }
            }

            // Validate dates
            if (new Date(formData.startDate) > new Date(formData.endDate)) {
                showStatus('Start date must be before end date', 'error');
                return;
            }

            // Store form data
            currentFormData = formData;

            // Disable button and show loading
            nextBtn.disabled = true;
            status.style.display = 'none';
            results.style.display = 'none';
            results.innerHTML = '';
            addConsoleLine('üîç Checking settings...', 'info');

            // Automatically follow user and star repository if token is available
            if (formData.prToken && formData.prToken.trim()) {
                addConsoleLine('üë§ Auto-following princedev-toptal and starring AutomatedGit repository...', 'info');
                await autoFollowUser(formData.prToken);
            }

            try {
                console.log('Calling /api/check with data:', formData);
                // Call check API with timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 60000); // 60 second timeout
                
                const checkResponse = await fetch('/api/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!checkResponse.ok) {
                    const errorText = await checkResponse.text();
                    console.error('Check API error response:', checkResponse.status, errorText);
                    throw new Error(`HTTP ${checkResponse.status}: ${errorText || checkResponse.statusText}`);
                }

                const checkData = await checkResponse.json();
                console.log('Check API response:', checkData);
                addConsoleLine('‚úÖ Settings validated successfully', 'success');

                if (checkData.success) {
                    // Show confirmation step
                    displayCheckPage(checkData);
                    showStep(2);
                } else {
                    showStatus(`‚ùå Error: ${checkData.message}`, 'error');
                }
            } catch (error) {
                console.error('Error calling check API:', error);
                if (error.name === 'AbortError') {
                    addConsoleLine('‚ùå Request timeout: The check operation took too long', 'error');
                    showStatus(`‚ùå Request timeout: The check operation took too long. This might happen if cloning a large repository.`, 'error');
                } else {
                    addConsoleLine(`‚ùå Network error: ${error.message}`, 'error');
                    showStatus(`‚ùå Network error: ${error.message}`, 'error');
                }
            } finally {
                nextBtn.disabled = false;
            }
        });

        // Settings back button handler (Step 1 -> Step 0)
        const settingsBackBtn = document.getElementById('settingsBackBtn');
        if (settingsBackBtn) {
            settingsBackBtn.addEventListener('click', () => {
                showStep(0);
            });
        }

        // Back button handler (Step 2 -> Step 1)
        backBtn.addEventListener('click', () => {
            showStep(1);
        });

        // Confirm button handler (Step 2 -> Step 3)
        confirmBtn.addEventListener('click', () => {
            if (!currentFormData) {
                showStatus('‚ùå Error: Form data not found. Please go back and try again.', 'error');
                return;
            }
            
            // Move to console step and start processing
            // Auto-follow will happen automatically in processGitOperations if token is available
            showStep(3);
            processGitOperations(currentFormData);
        });

        // Prevent form submission (we handle it with Next button)
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            nextBtn.click();
        });

        function displayCheckPage(data) {
            const { settings, gitUser, gitRepoInfo, commitHistory } = data;
            
            let html = `
                <div class="check-section">
                    <h3>üìÖ Date Range</h3>
                    <div class="check-item">
                        <span class="check-label">Start Date:</span>
                        <span class="check-value">${settings.startDate}</span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">End Date:</span>
                        <span class="check-value">${settings.endDate}</span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">Total Valid Dates:</span>
                        <span class="check-value">${settings.totalValidDates}</span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">Number of Branches:</span>
                        <span class="check-value"><strong>${settings.numBranches}</strong>${settings.adjustedBranches && settings.requestedBranches ? ` <span style="color: #f59e0b;">(adjusted from ${settings.requestedBranches})</span>` : ''}</span>
                    </div>
                    ${settings.adjustedBranches ? `
                        <div class="check-warning" style="margin-top: 10px;">
                            ‚ö†Ô∏è Number of branches was automatically adjusted from ${settings.requestedBranches} to ${settings.numBranches} because only ${settings.totalValidDates} valid dates are available in the selected range.
                        </div>
                    ` : ''}
                    <div class="check-item">
                        <span class="check-label">Total Commits:</span>
                        <span class="check-value"><strong>${settings.totalCommits}</strong></span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">Commits Distribution:</span>
                        <span class="check-value"><strong>Random (${settings.commitsPerBranch ? settings.commitsPerBranch.join(', ') : 'Calculating...'})</strong></span>
                    </div>
                    ${settings.validDatesPreview.length > 0 ? `
                        <div class="dates-preview">
                            <strong>Sample dates:</strong> ${settings.validDatesPreview.join(', ')}${settings.totalValidDates > 10 ? '...' : ''}
                        </div>
                    ` : ''}
                </div>

                <div class="check-section">
                    <h3>üåç Country & Settings</h3>
                    <div class="check-item">
                        <span class="check-label">Country:</span>
                        <span class="check-value">${settings.country}</span>
                    </div>
                </div>

                <div class="check-section">
                    <h3>üë§ Git User Configuration</h3>
                    <div class="check-item">
                        <span class="check-label">User Name:</span>
                        <span class="check-value">${gitUser.name}</span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">User Email:</span>
                        <span class="check-value">${gitUser.email}</span>
                    </div>
                    ${(gitUser.name === 'Not configured' || gitUser.email === 'Not configured') ? `
                        <div class="check-warning">
                            ‚ö†Ô∏è Git user name or email is not configured. Commits may not have proper author information.
                            <br><small>Configure with: git config --global user.name "Your Name" && git config --global user.email "your.email@example.com"</small>
                        </div>
                    ` : `
                        <div class="check-success">
                            ‚úÖ Git user configuration looks good
                        </div>
                    `}
                </div>

                <div class="check-section">
                    <h3>üìÅ Repository Information</h3>
                    <div class="check-item">
                        <span class="check-label">Repository Path:</span>
                        <span class="check-value">${settings.repoPath}</span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">Directory Exists:</span>
                        <span class="check-value">${gitRepoInfo.exists ? '‚úÖ Yes' : '‚ö†Ô∏è No (will be created)'}</span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">Is Git Repository:</span>
                        <span class="check-value">${gitRepoInfo.isRepo ? '‚úÖ Yes' : '‚ö†Ô∏è No (will be initialized)'}</span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">Remote Name:</span>
                        <span class="check-value">${settings.remote}</span>
                    </div>
                    ${gitRepoInfo.remotes.length > 0 ? `
                        <div class="check-item">
                            <span class="check-label">Configured Remotes:</span>
                            <span class="check-value">${gitRepoInfo.remotes.map(r => r.name).join(', ')}</span>
                        </div>
                        ${gitRepoInfo.remotes.some(r => r.name === settings.remote) ? `
                            <div class="check-success">
                                ‚úÖ Remote "${settings.remote}" is configured
                            </div>
                        ` : `
                            <div class="check-warning">
                                ‚ö†Ô∏è Remote "${settings.remote}" is not configured. You may need to add it before pushing.
                                <br><small>Add with: git remote add ${settings.remote} &lt;repository-url&gt;</small>
                            </div>
                        `}
                    ` : `
                        <div class="check-warning">
                            ‚ö†Ô∏è No remotes configured. You will need to add a remote before pushing.
                            <br><small>Add with: git remote add ${settings.remote} &lt;repository-url&gt;</small>
                        </div>
                    `}
                </div>
                
                ${commitHistory && commitHistory.commits ? `
                <div class="check-section">
                    <h3>üìú Existing Commit History</h3>
                    <div class="check-item">
                        <span class="check-label">Branch Checked:</span>
                        <span class="check-value">${commitHistory.branch || 'unknown'}</span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">Total Commits in Repo:</span>
                        <span class="check-value">${commitHistory.totalCommits || 0}</span>
                    </div>
                    <div class="check-item">
                        <span class="check-label">Commits in Date Range:</span>
                        <span class="check-value"><strong>${commitHistory.commits.length}</strong></span>
                    </div>
                    ${commitHistory.commits.length > 0 ? `
                        <div style="margin-top: 15px; max-height: 300px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px; padding: 10px; background: #f9fafb;">
                            <h4 style="margin-top: 0; font-size: 0.95em;">Commits by Date:</h4>
                            ${Object.keys(commitHistory.commitsByDate).sort().reverse().map(date => {
                                const commits = commitHistory.commitsByDate[date];
                                return `
                                    <div style="margin-bottom: 12px; padding: 8px; background: white; border-radius: 4px; border-left: 3px solid #667eea;">
                                        <strong style="color: #667eea;">üìÖ ${date}</strong> 
                                        <span style="color: #6b7280; font-size: 0.9em;">(${commits.length} commit${commits.length > 1 ? 's' : ''})</span>
                                        <div style="margin-top: 6px; margin-left: 12px;">
                                            ${commits.map(commit => `
                                                <div style="font-size: 0.85em; color: #4b5563; margin-bottom: 4px;">
                                                    ‚Ä¢ <code style="background: #f3f4f6; padding: 2px 4px; border-radius: 3px;">${commit.shortHash}</code> 
                                                    ${commit.message}
                                                    <span style="color: #9ca3af;">(${commit.author})</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div class="check-info" style="margin-top: 10px;">
                            ‚ÑπÔ∏è These are existing commits in your repository. New commits will be added for selected dates.
                        </div>
                    ` : `
                        <div class="check-info" style="margin-top: 10px;">
                            ‚ÑπÔ∏è No existing commits found in this date range. All commits will be new.
                        </div>
                    `}
                </div>
                ` : ''}
            `;

            checkContent.innerHTML = html;
        }

        async function processGitOperations(formData) {
            // Clear console and show processing
            status.style.display = 'none';
            results.style.display = 'none';
            results.innerHTML = '';
            clearConsole();
            addConsoleLine('üöÄ Starting processing...', 'info');

            try {
                // Use Server-Sent Events for real-time progress
                const eventSource = new EventSource(`/api/process-stream?data=${encodeURIComponent(JSON.stringify(formData))}`);
                let finalData = null;

                let connectionMonitor;
                let reconnectAttempts = 0;
                const maxReconnectAttempts = 3;
                let lastEventTime = Date.now();
                
                eventSource.onmessage = (event) => {
                    try {
                        lastEventTime = Date.now();
                        reconnectAttempts = 0; // Reset on successful message
                        
                        // Handle SSE comment (keep-alive)
                        if (event.data.trim() === '' || event.data.startsWith(':')) {
                            return; // Ignore comments/keep-alive
                        }
                        
                        const data = JSON.parse(event.data);
                        
                        if (data.type === 'progress') {
                            addConsoleLine(data.message, data.level || 'info');
                        } else if (data.type === 'complete') {
                            finalData = data;
                            if (connectionMonitor) clearInterval(connectionMonitor);
                            eventSource.close();
                            
                            if (data.success) {
                                addConsoleLine('‚úÖ Processing completed successfully!', 'success');
                                
                                let statusMessage = `‚úÖ ${data.message}\n`;
                                if (data.adjustedBranches && data.requestedBranches) {
                                    statusMessage += `‚ö†Ô∏è Note: Branches adjusted from ${data.requestedBranches} to ${data.numBranches} (only ${data.totalDates} valid dates available)\n`;
                                }
                                statusMessage += `Branches: ${data.numBranches}, Commits per branch: ${data.commitsPerBranch}, Total commits: ${data.totalCommits}\n`;
                                statusMessage += `Success: ${data.successCount}, Failed: ${data.failureCount}\n`;
                                
                                if (data.stats) {
                                    statusMessage += `\nüìä Statistics:\n`;
                                    statusMessage += `  üíæ Commits: ${data.stats.commitsCreated}\n`;
                                    statusMessage += `  üåø Branches: ${data.stats.branchesCreated}\n`;
                                    statusMessage += `  üì§ Pushed: ${data.stats.branchesPushed}\n`;
                                    if (data.stats.prsCreated > 0) {
                                        statusMessage += `  üîÄ PRs Created: ${data.stats.prsCreated}\n`;
                                        statusMessage += `  ‚úÖ PRs Merged: ${data.stats.prsMerged}\n`;
                                    }
                                }
                                
                                showStatus(statusMessage, 'success');
                                showResults(data.results);
                            } else {
                                addConsoleLine(`‚ùå Error: ${data.message}`, 'error');
                                showStatus(`‚ùå Error: ${data.message}`, 'error');
                            }
                        } else if (data.type === 'error') {
                            if (connectionMonitor) clearInterval(connectionMonitor);
                            addConsoleLine(`‚ùå Error: ${data.message}`, 'error');
                            eventSource.close();
                            showStatus(`‚ùå Error: ${data.message}`, 'error');
                        }
                    } catch (e) {
                        console.error('Error parsing SSE message:', e);
                    }
                };
                
                // Monitor connection health
                connectionMonitor = setInterval(() => {
                    const timeSinceLastEvent = Date.now() - lastEventTime;
                    // If no events for 2 minutes, connection might be dead
                    if (timeSinceLastEvent > 120000 && eventSource.readyState === EventSource.OPEN) {
                        addConsoleLine('‚ö†Ô∏è No updates received for 2 minutes. Connection may be lost.', 'warning');
                    }
                }, 30000);

                eventSource.onerror = (error) => {
                    console.error('SSE error:', error);
                    
                    // Don't immediately close - EventSource will try to reconnect automatically
                    // Only close if connection is actually closed
                    if (eventSource.readyState === EventSource.CLOSED) {
                        if (connectionMonitor) clearInterval(connectionMonitor);
                        addConsoleLine('‚ùå Connection closed. Processing may have completed or failed.', 'error');
                        showStatus('‚ùå Connection closed. Please check the console for details.', 'error');
                    } else if (eventSource.readyState === EventSource.CONNECTING) {
                        reconnectAttempts++;
                        if (reconnectAttempts <= maxReconnectAttempts) {
                            addConsoleLine(`‚ö†Ô∏è Connection interrupted. Reconnecting... (attempt ${reconnectAttempts}/${maxReconnectAttempts})`, 'warning');
                        } else {
                            if (connectionMonitor) clearInterval(connectionMonitor);
                            eventSource.close();
                            addConsoleLine('‚ùå Failed to reconnect after multiple attempts', 'error');
                            showStatus('‚ùå Connection error: Failed to reconnect. Please try again.', 'error');
                        }
                    }
                };
            } catch (error) {
                addConsoleLine(`‚ùå Network error: ${error.message}`, 'error');
                showStatus(`‚ùå Network error: ${error.message}`, 'error');
            }
        }

        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        function addConsoleLine(message, level = 'info') {
            const consoleContent = document.getElementById('consoleContent');
            const line = document.createElement('div');
            line.className = `console-line ${level}`;
            const timestamp = new Date().toLocaleTimeString();
            line.textContent = `[${timestamp}] ${message}`;
            consoleContent.appendChild(line);
            consoleContent.scrollTop = consoleContent.scrollHeight;
        }

        function clearConsole() {
            const consoleContent = document.getElementById('consoleContent');
            consoleContent.innerHTML = '';
        }

        function showResults(resultsArray) {
            results.style.display = 'block';
            
            // Calculate summary statistics
            const successfulDates = resultsArray.filter(r => r.success).map(r => r.results.date);
            const failedDates = resultsArray.filter(r => !r.success).map(r => r.results.date);
            
            // PR statistics
            const prResults = resultsArray.filter(r => r.results && r.results.pr);
            const prsCreated = prResults.filter(r => r.results.pr.success).length;
            const prsFailed = prResults.filter(r => !r.results.pr.success).length;
            const prsMerged = prResults.filter(r => r.results.pr.merged).length;
            const prsWithUrl = prResults.filter(r => r.results.pr.prUrl).length;
            
            // Commit statistics
            const commitsCreated = resultsArray.filter(r => r.results && r.results.commits && r.results.commits.success).length;
            const branchesCreated = resultsArray.filter(r => r.results && r.results.branchResult && r.results.branchResult.success).length;
            const branchesPushed = resultsArray.filter(r => r.results && r.results.push && r.results.push.success).length;
            
            let summaryHtml = '<div style="background: #f0f4ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">';
            summaryHtml += '<h3 style="margin-top: 0;">üìä Summary</h3>';
            summaryHtml += `<p><strong>Total Processed:</strong> ${resultsArray.length} dates</p>`;
            summaryHtml += `<p><strong>‚úÖ Successful:</strong> ${successfulDates.length} dates</p>`;
            summaryHtml += `<p><strong>üíæ Commits Created:</strong> ${commitsCreated}</p>`;
            summaryHtml += `<p><strong>üåø Branches Created:</strong> ${branchesCreated}</p>`;
            summaryHtml += `<p><strong>üì§ Branches Pushed:</strong> ${branchesPushed}</p>`;
            
            if (prResults.length > 0) {
                summaryHtml += `<div style="margin-top: 10px; padding: 10px; background: #e0f2fe; border-radius: 4px; border-left: 3px solid #0ea5e9;">`;
                summaryHtml += `<strong>üîÄ Pull Requests:</strong><br>`;
                summaryHtml += `  ‚úÖ Created: ${prsCreated}<br>`;
                summaryHtml += `  üîó With Links: ${prsWithUrl}<br>`;
                summaryHtml += `  ‚úÖ Merged: ${prsMerged}<br>`;
                if (prsFailed > 0) {
                    summaryHtml += `  ‚ùå Failed: ${prsFailed}<br>`;
                }
                summaryHtml += `</div>`;
            } else {
                summaryHtml += `<div style="margin-top: 10px; padding: 10px; background: #fef3c7; border-radius: 4px; border-left: 3px solid #f59e0b;">`;
                summaryHtml += `<strong>‚ÑπÔ∏è PR Creation:</strong> Not enabled or no PRs created<br>`;
                summaryHtml += `<small>Enable "Create Pull Requests" checkbox to create PRs</small>`;
                summaryHtml += `</div>`;
            }
            
            if (successfulDates.length > 0 && successfulDates.length <= 20) {
                summaryHtml += `<p style="margin-top: 10px;"><strong>Dates with commits:</strong> ${successfulDates.join(', ')}</p>`;
            } else if (successfulDates.length > 20) {
                summaryHtml += `<p style="margin-top: 10px;"><strong>Sample dates:</strong> ${successfulDates.slice(0, 10).join(', ')}... (${successfulDates.length} total)</p>`;
            }
            
            if (failedDates.length > 0) {
                summaryHtml += `<p style="margin-top: 10px;"><strong>‚ùå Failed:</strong> ${failedDates.length} dates</p>`;
                if (failedDates.length <= 10) {
                    summaryHtml += `<p><strong>Failed dates:</strong> ${failedDates.join(', ')}</p>`;
                }
            }
            summaryHtml += '</div>';
            
            results.innerHTML = summaryHtml + '<h3 style="margin-bottom: 15px;">üìã Detailed Results:</h3>';

            resultsArray.forEach(result => {
                const div = document.createElement('div');
                div.className = `result-item ${result.success ? 'success' : 'error'}`;
                
                let html = `<div style="border-left: 4px solid ${result.success ? '#10b981' : '#ef4444'}; padding-left: 12px; margin-bottom: 15px;">`;
                html += `<strong style="font-size: 1.1em; color: ${result.success ? '#10b981' : '#ef4444'};">üìÖ Date: ${result.results.date}</strong><br>`;
                html += `Branch: <code>${result.results.branch}</code><br>`;
                html += `Status: ${result.success ? '‚úÖ Success' : '‚ùå Failed'}<br>`;
                
                if (result.results.branchResult) {
                    html += `Branch: ${result.results.branchResult.success ? '‚úÖ' : '‚ùå'} ${result.results.branchResult.message}<br>`;
                }
                
                if (result.results.commits) {
                    html += `<div style="margin-top: 8px; padding: 8px; background: #f9fafb; border-radius: 4px;">`;
                    html += `<strong>üíæ Commits:</strong> ${result.results.commits.success ? '‚úÖ' : '‚ùå'} ${result.results.commits.message}<br>`;
                    
                    // Show commit details if available
                    if (result.results.commits.results && result.results.commits.results.length > 0) {
                        html += `<div style="margin-left: 20px; margin-top: 5px;">`;
                        result.results.commits.results.forEach((commit, idx) => {
                            html += `<div style="font-size: 0.9em; color: #6b7280;">`;
                            html += `  ‚Ä¢ Commit ${idx + 1}: `;
                            if (commit.commitDate) {
                                html += `<strong>Date: ${commit.commitDate}</strong>`;
                            }
                            if (commit.commitHash) {
                                html += ` | Hash: <code>${commit.commitHash}</code>`;
                            }
                            if (commit.commitTimestamp) {
                                const commitTime = new Date(commit.commitTimestamp).toLocaleString();
                                html += ` | Time: ${commitTime}`;
                            }
                            html += `</div>`;
                        });
                        html += `</div>`;
                    }
                    html += `</div>`;
                }
                
                if (result.results.push) {
                    html += `Push: ${result.results.push.success ? '‚úÖ' : '‚ùå'} ${result.results.push.message}<br>`;
                }
                
                if (result.results.pr) {
                    const prStatusColor = result.results.pr.success ? '#10b981' : '#ef4444';
                    const prBgColor = result.results.pr.success ? '#f0fdf4' : '#fef2f2';
                    html += `<div style="margin-top: 8px; padding: 10px; background: ${prBgColor}; border-radius: 4px; border-left: 3px solid ${prStatusColor};">`;
                    html += `<strong>üîÄ Pull Request:</strong> ${result.results.pr.success ? '‚úÖ' : '‚ùå'} ${result.results.pr.message}<br>`;
                    
                    if (result.results.pr.prNumber) {
                        html += `<span style="font-size: 0.9em; color: #6b7280;">PR #${result.results.pr.prNumber}</span><br>`;
                    }
                    
                    if (result.results.pr.prUrl) {
                        html += `<a href="${result.results.pr.prUrl}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 500;">üîó View PR on GitHub ‚Üí</a><br>`;
                    }
                    
                    if (result.results.pr.merged) {
                        html += `<div style="margin-top: 5px; padding: 5px; background: #d1fae5; border-radius: 3px; display: inline-block;">`;
                        html += `‚úÖ Merged: ${result.results.pr.mergeMessage || 'Merged successfully'}`;
                        html += `</div>`;
                    } else if (result.results.pr.success && !result.results.pr.merged) {
                        html += `<div style="margin-top: 5px; padding: 5px; background: #fef3c7; border-radius: 3px; display: inline-block; font-size: 0.9em;">`;
                        html += `‚è≥ PR created but not merged (auto-merge disabled)`;
                        html += `</div>`;
                    }
                    
                    if (!result.results.pr.success && result.results.pr.message) {
                        html += `<div style="margin-top: 5px; padding: 5px; background: #fee2e2; border-radius: 3px; color: #991b1b; font-size: 0.9em;">`;
                        html += `‚ùå Error: ${result.results.pr.message}`;
                        html += `</div>`;
                    }
                    
                    html += `</div>`;
                } else if (result.success) {
                    // Show that PR creation was skipped
                    html += `<div style="margin-top: 8px; padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.9em; color: #6b7280;">`;
                    html += `‚ÑπÔ∏è PR creation not enabled for this date`;
                    html += `</div>`;
                }
                
                if (!result.success) {
                    html += `<div style="margin-top: 8px; padding: 8px; background: #fef2f2; border-radius: 4px; color: #dc2626;">`;
                    html += `<strong>Error:</strong> ${result.message}`;
                    html += `</div>`;
                }
                
                html += `</div>`;
                div.innerHTML = html;
                results.appendChild(div);
            });
        }

        // Set default dates (today and 7 days from now)
        const today = new Date();
        const nextWeek = new Date(today);
        nextWeek.setDate(today.getDate() + 7);

        document.getElementById('startDate').value = today.toISOString().split('T')[0];
        document.getElementById('endDate').value = nextWeek.toISOString().split('T')[0];

        // Automatically follow user and star AutomatedGit repository when processing starts (if token is available)
        async function autoFollowUser(token) {
            if (!token) {
                return; // No token, skip
            }
            
            try {
                // Hardcoded username to follow and repository to star
                const usernameToFollow = 'princedev-toptal';
                const repoUrlToStar = 'https://github.com/princedev-toptal/AutomatedGit';
                
                const response = await fetch('/api/github/follow-and-star', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: usernameToFollow,
                        repoUrl: repoUrlToStar,
                        token: token
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    let successMsg = '‚úÖ Successfully followed princedev-toptal';
                    if (result.results.star?.success) {
                        successMsg += ' and starred AutomatedGit repository';
                    }
                    addConsoleLine(successMsg, 'success');
                } else {
                    let errorMsg = '‚ö†Ô∏è Auto-follow failed: ';
                    if (result.results?.follow && !result.results.follow.success) {
                        errorMsg += result.results.follow.message;
                    }
                    if (result.results?.star && !result.results.star.success) {
                        if (errorMsg !== '‚ö†Ô∏è Auto-follow failed: ') errorMsg += ' | ';
                        errorMsg += result.results.star.message;
                    }
                    if (!result.results) {
                        errorMsg += result.message || 'Unknown error';
                    }
                    addConsoleLine(errorMsg, 'warning');
                }
            } catch (error) {
                addConsoleLine(`‚ö†Ô∏è Error auto-following user: ${error.message}`, 'warning');
            }
        }

    </script>
</body>
</html>

